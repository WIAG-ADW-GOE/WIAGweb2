{% extends 'base.html.twig' %}
{% set menuItem='collections' %}

{% block javascripts %}
    {{ parent() }}
{% endblock %}

{% block body %}
    {% set permalink %}{{ protocol }}:{{ url('id', {id: person.item.idPublic}, schemeRelative = true) }}{% endset %}
    {% set citation %}"{{ person.displayname }}" in: WIAG, {{ protocol }}:{{ url('id', {id: person.item.idPublic}, schemeRelative = true) }} (Abgerufen: {{ "now"|date('d.m.Y') }}).{% endset %}

    {# person is passed as an object #}
    {% if not person%}
	<p class="em">Person nicht gefunden.</p>
    {% else %}
	{% set btnpanel %}
	<div class="row mx-2 col-12 mt-4 mb-2">
	    <div class="d-flex">
		{% if form is defined %}
		    {{ include('person/_button_step.html.twig',
			{formaction: path('bishop_list_detail'), value: offset - 1, disabled: offset == 0, text: 'vorheriger Treffer'}) }}
		    {{ include('person/_button_step.html.twig',
			{formaction: path('bishop_list_detail'), value: offset + 1, disabled: not hassuccessor, text: 'nächster Treffer'}) }}
		    <button type="submit" form="form" class="btn btn-outline-secondary btn-sm me-1" name="offset" value="{{ offset }}">Ergebnisliste</button>
		    <a href="{{ path('bishop_query') }}" type="button" class="btn btn-outline-secondary btn-sm me-3">Neue Suche</a>
		{% else %}
		    <a href="{{ path('bishop_query') }}" type="button" class="btn btn-outline-secondary btn-sm me-3">Suche</a>
		{% endif %}
		{# button data #}
		{% for fmtft in [
		    {format: 'Csv', text: 'CSV'},
		    {format: 'Rdf', text: 'RDF-XML'},
		    {format: 'Json', text: 'JSON'},
		    {format: 'Jsonld', text: 'JSON-LD'},
		] %}
		    <a href="{{ path('id', {id: person.item.idpublic, format: fmtft.format}) }}" type="button" class="btn btn-secondary btn-light btn-sm ms-2">{{ fmtft.text }}</a>
		{% endfor %}
	    </div>
	</div>
	{% endset %}
	{% if form is defined %}
	    {{ form_start(form, {'attr': {'id':'form', 'action':path('bishop_query'), 'hidden': 'hidden'} }) }}
		{{ include('bishop/_form_elements.html.twig') }}
	    {{ form_end(form) }}
	{% endif %}
	<div class="container-fluid mt-3 mb-2">
	    <div class="row mx-2 col-12">
		<span class="topic-title">{{ bishop_title }} <a href="{{ path('reference_list', { 'itemTypeId': 4}) }}"><span class="text-nowrap">(nach Erwin Gatz)</span></a></span>
	    </div>
	    {{ btnpanel }}
	    {# name, comments, dates of birth and death #}
	    {{ include('person/_person_header.html.twig', {person: person, idpublic: person.item.idpublic }, with_context = false) }}
	    {# offices #}
	    {% for item_loop in item %}
		{% set office_title = '' %}
		{% if item_loop.getsource == 'Bischof' %}
		    {% set office_title = 'Amtsangaben aus Referenzwerken' %}
		{% elseif item_loop.getsource == 'Domherr' %}
		    {% set office_title = 'Amtsangaben aus der Datenbank Domherren des Alten Reiches' %}
		{% elseif item_loop.getsource == 'Bischof GS' or item_loop.getsource == 'Domherr GS' %}
		    {% set gsnid = item_loop.getidexternalobj('GS') %}
		    {% set office_title %}<a href="{{ gsnid.authority.urlformatter~gsnid.value  }}" target="_blank" rel="noopener"><strong>Amtsangaben aus dem Digitalen Personenregister der Germania Sacra — {{ gsnid.value }}</strong></a>{% endset %}
		{% endif %}
		{{ include('person/_person_role_group.html.twig', {
		    person: item_loop.person,
		    title: office_title,
		    with_context: false
		}) }}
	    {% endfor %}

	    {# external IDs #}
	    {% if person.item.idExternal %}
		<div class="row mx-2 mt-3 mb-2">
		    <div class="col-12">
			{{ include('person/_person_id_external.html.twig', {
			    ids: person.item.idExternal
			}) }}
		    </div>
		</div>
	    {% endif %}
	    <div class="row mx-2">
		<div class="col-12">
		    Empfohlene Zitierweise:
		    <button type="button"
			    class="btn btn-sm"
			    title="Kopiere die Zitierweise"
			    {{ stimulus_controller('clipboard') }}
			    data-action="clipboard#copyCitation"><img src="{{ asset('images/clipboard.svg') }}"></button><br/>
		    <span id="citation">{{ citation }}</span>
		</div>
	    </div>
	    {# button line #}
	    {{ btnpanel }}
	</div>
    {% endif %}
{% endblock %}
