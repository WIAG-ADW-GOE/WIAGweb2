{# parameter: role, base_id_role, base_input_name_role #}
{% set input_institution_width=25 %}
<div class="my-1"
     data-controller="toggle-arrow input-state select-institution"
     data-select-institution-base-width-value="{{ input_institution_width }}%"
     data-toggle-arrow-img-open-value="down"
     data-toggle-arrow-img-closed-value="right"
     data-action="shown.bs.collapse->toggle-arrow#shown hidden.bs.collapse->toggle-arrow#hidden">
    <div class="input-group input-group-sm">
	<span class="input-group-text wiag-input-text-blue">Amt, Institution</span>
	{# id (hidden) #}
	<input type="text"
	       id="{{ base_id_role }}_id"
	       name="{{ base_input_name_role }}[id]"
	       class="form-control form-control-sm"
	       value="{{ role.id }}"
	       hidden="hidden>">
	{# role name #}
	<span class="w-15"
    	      {{ stimulus_controller('autocomplete', {
		  url: path('person_suggest', {itemTypeId: '0', field: 'role'}),
	      }) }}>
	    <input type="text" id="{{ base_id_role }}_role"
		   name="{{ base_input_name_role }}[role]"
		   class="form-control form-control-sm rounded-0 wiag-input"
		   value="{{ role.roleDisplayName }}"
		   spellcheck="false"
		   aria-label="Amt"
		   data-autocomplete-target="input">
	    <ul class="list-group autocomplete-target"
		       data-autocomplete-target="results"
		       style="max-width: 18rem;"></ul>
	</span>
	{# diocese/monastery #}
	{# - choose one of the input elements #}
	{% set hasInstitution=(role.institutionDisplayName|length > 0)  %}
	<div class="form-check form-check-inline ms-2 mt-1 align-middle">
	    <input class="form-check-input"
		   type="radio"
		   name="{{ base_input_name_role }}[optInstitution]"
		   id="{{ base_id_role }}_optInstitution_1"
		   value="0"
		   {% if not hasInstitution %}checked="checked"{% endif %}
		   data-action="select-institution#toggle">
	    <label class="form-check-label" for="{{ base_input_name_role }}_optInstitution_1">Bistum</label>
	</div>
	<div class="form-check form-check-inline mt-1 align-middle">
	    <input class="form-check-input"
		   type="radio"
		   name="{{ base_input_name_role }}[optInstitution]"
		   id="{{ base_id_role }}_optInstitution_2"
		   value="1"
		   {% if hasInstitution %}checked="checked"{% endif %}
		   data-action="select-institution#toggle">
	    <label class="form-check-label" for="{{ base_input_name_role }}_optInstitution_2">Kloster/Stift</label>
	</div>
	<span style="width: {{ input_institution_width * (not hasInstitution) }}%"
	      {{ stimulus_controller('autocomplete', {
		  url: path('person_suggest', {itemTypeId: '0', field: 'diocese'}),
	      }) }}
	      data-select-institution-target="carrier"
	      data-action="change->select-institution#clear">
	    <input type="text"
		   id="{{ base_id_role }}_diocese"
		   name="{{ base_input_name_role }}[diocese]"
		   class="form-control form-control-sm rounded-0 wiag-input"
		   value="{{ role.dioceseDisplayName }}"
		   spellcheck="false"
		   aria-label="Institution"
		   data-autocomplete-target="input">
	    <ul class="list-group autocomplete-target"
		data-autocomplete-target="results"
		style="max-width: 12rem;"></ul>
	</span>
	{# monastery/domstift #}
	<span style="width: {{ input_institution_width * hasInstitution }}%"
	      {{ stimulus_controller('autocomplete', {
		  url: path('person_suggest', {itemTypeId: '0', field: 'institution'}),
	      }) }}
	      data-select-institution-target="carrier"
	      data-action="change->select-institution#clear">
	    <input type="text" id="{{ base_id_role }}_institution"
		   name="{{ base_input_name_role }}[institution]"
		   class="form-control form-control-sm rounded-0 wiag-input"
		   value="{{ role.institutionDisplayName }}"
		   spellcheck="false"
		   aria-label="Kloster"
		   data-controller="move-cursor"
		   data-action="blur->move-cursor#moveStart"
		   data-autocomplete-target="input">
	    <ul class="list-group autocomplete-target"
		data-autocomplete-target="results"
		style="max-width: 20rem;"></ul>
	</span>
	<span class="input-group-text wiag-input-text-blue">von, bis</span>
	<input type="text" id="{{ base_id_role }}_dateBegin"
	       name="{{ base_input_name_role }}[dateBegin]"
	       class="form-control form-control-sm wiag-input"
	       value="{{ role.dateBegin }}"
	       style="max-width: 6rem"
	       spellcheck="false"
	       aria-label="Beginn">
	<input type="text" id="{{ base_id_role }}_dateEnd"
	       name="{{ base_input_name_role }}[dateEnd]"
	       class="form-control form-control-sm wiag-input"
	       value="{{ role.dateEnd }}"
	       style="max-width: 6rem"
	       spellcheck="false"
	       aria-label="Ende">
	{% if intern_collapsable %}
	    {% if role.comment or role.note or role.roleproperty|length > 0 %}
		{% set expanded = true %}
	    {% else %}
		{% set expanded = false %}
	    {% endif %}
	    <button class="btn btn-sm ms-1 pt-0 align-middle"
		    type="button"
		    data-bs-toggle="collapse"
		    data-bs-target={{ "#comment_role#{role.id}" }}
		    aria-expanded="{{ expanded }}"
		    aria-controls={{ "comment_role#{role.id}" }}
		    data-toggle-arrow-target="button">{% if expanded %}<img src="{{ asset('images/symbols/caret-down-square.svg') }}"/>{% else %}<img src="{{ asset('images/symbols/caret-right-square.svg') }}"/>{% endif %}</button>
	{% else %}
	    {% set expanded = true %}
	{% endif %}
	{# delete #}
	<div class="form_check ms-1 mt-1 align-middle">
	    <input class="form-check-input"
		   type="checkbox"
		   value=""
		   id="{{ base_id_role }}_delete"
		   name="{{ base_input_name_role }}[delete]"
		   data-input-state-target="checkbox"
		   data-action="input-state#toggle">
	    <label class="form-check-label ms-1" for="{{ base_id_role }}_delete">l√∂schen</label>
	</div>
    </div>
    <div class="ms-4 collapse {% if expanded %}show{% endif %}" id ="{{ "comment_role#{role.id}" }}">
	<div class="input-group input-group-sm mt-1">
	    <span class="input-group-text wiag-input-text-blue">Bemerkung</span>
	    <input type="text"
		   id="{{ base_id_role }}_note"
		   name="{{ base_input_name_role }}[note]"
		   class="form-control form-control-sm wiag-input"
		   value="{{ role.note }}">
	</div>
	{{ include('edit_bishop/_input_role_property_list.html.twig') }}
    </div>
</div>
